<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Restaurangr√§knare</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f7;
            color: #1d1d1f;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            max-width: 100%;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #007AFF;
            font-size: 24px;
            font-weight: 600;
        }
        
        .items-list {
            flex-grow: 1;
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow-y: auto;
            max-height: 40vh;
        }
        
        .item-row {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .item-row:last-child {
            border-bottom: none;
        }
        
        .item-name {
            font-weight: 500;
        }
        
        .item-time {
            font-size: 13px;
            color: #8E8E93;
        }
        
        .total {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            font-weight: 600;
            font-size: 20px;
            color: #007AFF;
        }
        
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .item-btn {
            background: white;
            border: none;
            border-radius: 12px;
            padding: 18px 10px;
            font-size: 15px;
            font-weight: 500;
            color: #1d1d1f;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.2s ease;
            touch-action: manipulation;
        }
        
        .item-btn:active {
            transform: scale(0.98);
            background: #f0f0f0;
        }
        
        .drink-btn {
            border-left: 4px solid #007AFF;
        }
        
        .food-btn {
            border-left: 4px solid #34C759;
        }
        
        .action-btn {
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 20px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }
        
        .action-btn:active {
            transform: scale(0.98);
            background: #0056CC;
        }
        
        .export-btn {
            background: #34C759;
        }
        
        .export-btn:active {
            background: #2CA24F;
        }
        
        .reset-btn {
            background: #FF3B30;
            margin-top: 5px;
        }
        
        .reset-btn:active {
            background: #D70015;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            max-width: 300px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .modal h3 {
            margin-bottom: 20px;
            font-size: 20px;
            color: #1d1d1f;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .modal-btn {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .modal-btn-yes {
            background: #34C759;
            color: white;
        }
        
        .modal-btn-no {
            background: #FF3B30;
            color: white;
        }
        
        .modal-btn:active {
            transform: scale(0.98);
        }
        
        @media (max-width: 380px) {
            .buttons-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .item-btn {
                padding: 15px 8px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçΩÔ∏è Restaurangr√§knare</h1>
        
        <div class="items-list" id="itemsList">
            <!-- Items will appear here -->
            <div style="text-align: center; color: #8E8E93; padding: 20px;">
                Inga artiklar tillagda √§n
            </div>
        </div>
        
        <div class="total">
            Totalt: <span id="totalCount">0</span> artiklar
        </div>
        
        <div class="buttons-grid">
            <button class="item-btn drink-btn" data-item="40 cl √∂l stor stark">40 cl √∂l<br>stor stark</button>
            <button class="item-btn drink-btn" data-item="50 cl √∂l flaska">50 cl √∂l<br>flaska</button>
            <button class="item-btn drink-btn" data-item="50 cl 4,5% cider">50 cl<br>4,5% cider</button>
            <button class="item-btn drink-btn" data-item="50 cl 7,2% cider">50 cl<br>7,2% cider</button>
            <button class="item-btn drink-btn" data-item="4 cl starksprit">4 cl<br>starksprit</button>
            <button class="item-btn drink-btn" data-item="1.5L kanna √∂l">1.5L<br>kanna √∂l</button>
            <button class="item-btn drink-btn" data-item="3L kanna √∂l">3L<br>kanna √∂l</button>
            <button class="item-btn food-btn" data-item="Liten mat">Liten mat</button>
            <button class="item-btn food-btn" data-item="Stor mat">Stor mat</button>
        </div>
        
        <button class="action-btn export-btn" id="exportBtn">Exportera till CSV</button>
        <button class="action-btn reset-btn" id="resetBtn">Nollst√§ll kv√§ll</button>
    </div>
    
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h3 id="modalQuestion">Vill du registrera artikeln?</h3>
            <div class="modal-buttons">
                <button class="modal-btn modal-btn-yes" id="modalYes">Ja</button>
                <button class="modal-btn modal-btn-no" id="modalNo">Nej</button>
            </div>
        </div>
    </div>
    
    <script>
        // Initialize items array
        let items = JSON.parse(localStorage.getItem('restaurantItems')) || [];
        let pendingItem = null;
        
        // DOM Elements
        const itemsList = document.getElementById('itemsList');
        const totalCount = document.getElementById('totalCount');
        const itemButtons = document.querySelectorAll('.item-btn');
        const exportBtn = document.getElementById('exportBtn');
        const resetBtn = document.getElementById('resetBtn');
        const confirmModal = document.getElementById('confirmModal');
        const modalQuestion = document.getElementById('modalQuestion');
        const modalYes = document.getElementById('modalYes');
        const modalNo = document.getElementById('modalNo');
        
        // Update display
        function updateDisplay() {
            if (items.length === 0) {
                itemsList.innerHTML = '<div style="text-align: center; color: #8E8E93; padding: 20px;">Inga artiklar tillagda √§n</div>';
            } else {
                itemsList.innerHTML = items.map(item => `
                    <div class="item-row">
                        <div>
                            <div class="item-name">${item.name}</div>
                            <div class="item-time">${item.time}</div>
                        </div>
                    </div>
                `).join('');
            }
            totalCount.textContent = items.length;
        }
        
        // Show confirmation modal
        function showConfirmation(itemName) {
            pendingItem = itemName;
            modalQuestion.textContent = `Vill du registrera "${itemName}"?`;
            confirmModal.style.display = 'flex';
        }
        
        // Hide confirmation modal
        function hideConfirmation() {
            confirmModal.style.display = 'none';
            pendingItem = null;
        }
        
        // Add item to list
        function addItem(itemName) {
            const now = new Date();
            const timeString = now.toLocaleDateString('sv-SE') + ' ' + now.toLocaleTimeString('sv-SE', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            items.push({
                name: itemName,
                time: timeString,
                timestamp: now.toISOString()
            });
            
            localStorage.setItem('restaurantItems', JSON.stringify(items));
            updateDisplay();
        }
        
        // Export to CSV
        function exportToCSV() {
            if (items.length === 0) {
                alert('Inga artiklar att exportera!');
                return;
            }
            
            // Create CSV content
            let csvContent = "Artikel,Tid,Datum\n";
            items.forEach(item => {
                const [date, time] = item.time.split(' ');
                csvContent += `"${item.name}","${time}","${date}"\n`;
            });
            
            // Create and trigger download
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `restaurang_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('CSV-fil nedladdad! Du kan nu importera den till Numbers.');
        }
        
        // Reset items
        function resetItems() {
            if (confirm('√Ñr du s√§ker p√• att du vill nollst√§lla all data f√∂r kv√§llen? Detta kan inte √•ngras.')) {
                items = [];
                localStorage.removeItem('restaurantItems');
                updateDisplay();
            }
        }
        
        // Event Listeners
        itemButtons.forEach(button => {
            button.addEventListener('click', () => {
                const itemName = button.getAttribute('data-item');
                showConfirmation(itemName);
            });
        });
        
        modalYes.addEventListener('click', () => {
            if (pendingItem) {
                addItem(pendingItem);
                hideConfirmation();
            }
        });
        
        modalNo.addEventListener('click', hideConfirmation);
        
        exportBtn.addEventListener('click', exportToCSV);
        resetBtn.addEventListener('click', resetItems);
        
        // Close modal when clicking outside
        confirmModal.addEventListener('click', (e) => {
            if (e.target === confirmModal) {
                hideConfirmation();
            }
        });
        
        // Initial display update
        updateDisplay();
        
        // PWA features - make it installable
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(error => {
                    console.log('Service Worker registration failed:', error);
                });
            });
        }
        
        // Add to home screen prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Show install button if needed
            setTimeout(() => {
                if (deferredPrompt && confirm('Vill du l√§gga till denna app p√• hemsk√§rmen f√∂r snabbare √•tkomst?')) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then(() => {
                        deferredPrompt = null;
                    });
                }
            }, 3000);
        });
    </script>
</body>
</html>