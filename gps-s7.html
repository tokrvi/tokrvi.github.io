========================================
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geodatalogger S7</title>
    <style>
        * {
            font-size: 18px;
            font-family: Arial, sans-serif;
        }
        body {
            padding: 20px;
            background: #f0f0f0;
        }
        button {
            padding: 15px;
            margin: 10px 5px;
            font-size: 20px;
            border: none;
            border-radius: 10px;
            background: #4CAF50;
            color: white;
            min-width: 150px;
        }
        .stop-btn {
            background: #f44336;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            background: white;
            border-radius: 10px;
            border-left: 5px solid #2196F3;
        }
        .data-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }
        h1 {
            color: #333;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <h1>üìç Geodatalogger Samsung S7</h1>
    
    <div class="status" id="status">
        <strong>Status:</strong> Starta loggningen nedan
    </div>
    
    <button onclick="startLogging()" id="startBtn">‚ñ∂ STARTA LOGGNING</button>
    <button onclick="stopLogging()" id="stopBtn" class="stop-btn">‚ñ† STOPPA</button>
    <button onclick="exportData()" id="exportBtn">üì• EXPORTERA DATA</button>
    <button onclick="clearData()" id="clearBtn">üßπ RENSA ALLT</button>
    
    <div style="margin-top: 30px;">
        <h3>Senaste positioner:</h3>
        <div id="dataList"></div>
    </div>
    
    <div style="margin-top: 30px; font-size: 14px; color: #666;">
        <p><strong>Instruktioner:</strong></p>
        <ol>
            <li>Tryck p√• STARTA LOGGNING</li>
            <li>Tryck "Till√•t" n√§r telefonen fr√•gar om plats√•tkomst</li>
            <li>V√§lj "Till√•t alltid" eller "Till√•t hela tiden"</li>
            <li>Appen forts√§tter i bakgrunden</li>
            <li>Tryck STOPPA n√§r du √§r klar</li>
            <li>Exportera data med knappen üì•</li>
        </ol>
    </div>

    <script>
        // Variabler
        let watchId = null;
        let positions = [];
        let isLogging = false;
        
        // Ladda sparade data vid start
        window.onload = function() {
            loadSavedData();
            updateStatus('Redo att starta');
            document.getElementById('stopBtn').disabled = true;
        };
        
        // STARTA loggning
        function startLogging() {
            if (isLogging) return;
            
            updateStatus('Startar... V√§lj "Till√•t alltid"');
            
            // Kontrollera om geolocation finns
            if (!navigator.geolocation) {
                updateStatus('Fel: GPS st√∂ds inte p√• denna enhet');
                return;
            }
            
            // Options f√∂r GPS
            const options = {
                enableHighAccuracy: true,
                maximumAge: 0,
                timeout: 10000
            };
            
            // Starta position tracking
            watchId = navigator.geolocation.watchPosition(
                function(position) {
                    // Lyckad position
                    const pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        accuracy: position.coords.accuracy,
                        timestamp: new Date().toLocaleString('sv-SE'),
                        speed: position.coords.speed || 0
                    };
                    
                    // L√§gg till i lista
                    positions.push(pos);
                    
                    // Spara till lokal lagring
                    saveData();
                    
                    // Uppdatera display
                    updateStatus(`Loggar... ${positions.length} positioner sparade`);
                    addPositionToList(pos);
                    
                    // √Ñndra knappar
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('stopBtn').disabled = false;
                    
                    isLogging = true;
                },
                function(error) {
                    // Felhantering
                    let errorMsg = 'GPS-fel: ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg = 'Till√•t plats√•tkomst i inst√§llningarna';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg = 'Platsinformation inte tillg√§nglig';
                            break;
                        case error.TIMEOUT:
                            errorMsg = 'Timeout - kontrollera GPS-signal';
                            break;
                    }
                    updateStatus(errorMsg);
                    stopLogging();
                },
                options
            );
        }
        
        // STOPPA loggning
        function stopLogging() {
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
                watchId = null;
            }
            isLogging = false;
            updateStatus(`Stoppad. Totalt: ${positions.length} positioner`);
            
            // √Ñndra knappar
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
        }
        
        // SPARA data till telefonens minne
        function saveData() {
            try {
                localStorage.setItem('gpsPositions', JSON.stringify(positions));
            } catch (e) {
                updateStatus('Fel vid sparande: ' + e.message);
            }
        }
        
        // LADDA sparad data
        function loadSavedData() {
            try {
                const saved = localStorage.getItem('gpsPositions');
                if (saved) {
                    positions = JSON.parse(saved);
                    updateDataList();
                }
            } catch (e) {
                // Ignorera fel vid f√∂rsta anv√§ndning
            }
        }
        
        // L√ÑGG TILL position i lista
        function addPositionToList(pos) {
            const list = document.getElementById('dataList');
            const item = document.createElement('div');
            item.className = 'data-item';
            item.innerHTML = `
                <strong>${pos.timestamp}</strong><br>
                üìç Lat: ${pos.lat.toFixed(6)}, Lng: ${pos.lng.toFixed(6)}<br>
                Noggrannhet: ${pos.accuracy ? Math.round(pos.accuracy) + 'm' : 'Ok√§nd'}
            `;
            
            // L√§gg √∂verst
            if (list.firstChild) {
                list.insertBefore(item, list.firstChild);
            } else {
                list.appendChild(item);
            }
            
            // Begr√§nsa till 20 visade
            const items = list.getElementsByClassName('data-item');
            if (items.length > 20) {
                list.removeChild(items[items.length - 1]);
            }
        }
        
        // UPPDATERA hela listan
        function updateDataList() {
            const list = document.getElementById('dataList');
            list.innerHTML = '';
            
            // Visa senaste f√∂rst
            const reversed = [...positions].reverse();
            for (let i = 0; i < Math.min(reversed.length, 20); i++) {
                addPositionToList(reversed[i]);
            }
        }
        
        // UPPDATERA status
        function updateStatus(message) {
            document.getElementById('status').innerHTML = 
                `<strong>Status:</strong> ${message}`;
        }
        
        // EXPORTERA data som fil
        function exportData() {
            if (positions.length === 0) {
                updateStatus('Ingen data att exportera');
                return;
            }
            
            // Skapa CSV-inneh√•ll
            let csv = 'Tidst√§mpel,Breddgrad (Lat),L√§ngdgrad (Lng),Noggrannhet (m),Hastighet (m/s)\n';
            
            positions.forEach(pos => {
                csv += `"${pos.timestamp}",${pos.lat},${pos.lng},${pos.accuracy || 0},${pos.speed || 0}\n`;
            });
            
            // Skapa fil och ladda ner
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `gps_data_${new Date().getTime()}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            updateStatus(`Data exporterad (${positions.length} rader)`);
        }
        
        // RENSA all data
        function clearData() {
            if (confirm('√Ñr du s√§ker p√• att du vill radera ALL data?')) {
                positions = [];
                localStorage.removeItem('gpsPositions');
                updateDataList();
                updateStatus('All data raderad');
                
                if (isLogging) {
                    stopLogging();
                }
            }
        }
        
        // Visa varning vid st√§ngning
        window.addEventListener('beforeunload', function(e) {
            if (isLogging) {
                e.preventDefault();
                e.returnValue = 'Loggning p√•g√•r. √Ñr du s√§ker p√• att du vill l√§mna sidan?';
                return e.returnValue;
            }
        });
    </script>
</body>
</html>
========================================
